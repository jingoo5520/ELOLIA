<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.finalProject.mappers.cartMapper">
	<insert id="insertCart">
		insert into carts (member_id) values(#{memberId})
	</insert>
	
	<select id="selectCartNoByMemberId" resultType="Integer">
		select cart_no from carts where member_id = #{memberId}
	</select>
	
	<select id="selectCartItems" resultType="com.finalProject.model.cart.CartDTO">
		select p.product_no, p.product_name, p.product_price, i.image_main_url, c.cart_no, c.product_count, c.cart_item_no 
		from product_images i, products p 
		inner join cart_items c 
		on p.product_no = c.product_no 
		where p.product_no = i.product_no and c.cart_no = #{cartNo}
	</select>
	
	<update id="updateQuantity">
		update cart_items set product_count = #{quantity} 
		where product_no = #{productNo} 
		and cart_no = 
		(select cart_no from carts
		 where member_id = #{memberId})
	</update>
	
	<delete id="deleteCartItem">
		delete from cart_items 
		where product_no = #{productNo} 
		and cart_no = 
		(select cart_no from carts
		 where member_id = #{memberId})
	</delete>
	
	<insert id="insertCartItem">
		insert into cart_items (cart_no, product_no, product_count) values (#{cartNo}, #{productNo}, #{quantity})
	</insert>
	
	<select id="selectCountItemByProductNo" resultType="Integer">
		select count(*) from cart_items where product_no = #{productNo} and cart_no = #{cartNo}
	</select>
	
	<update id="updateQuantityFromAddItem">
		update cart_items set product_count = product_count + #{quantity} 
		where product_no = #{productNo} 
		and cart_no = 
		#{cartNo}
	</update>
</mapper>