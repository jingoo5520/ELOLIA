<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.finalProject.mappers.couponMapper">
	<!-- 쿠폰 총 개수 가져오기 -->
	<select id="selectCouponCnt" resultType="int">
		select count(*) from coupons
	</select>
	
	<!-- 쿠폰 리스트 가져오기 -->
	<select id="selectAllCoupon" resultType="CouponDTO">
		select
		coupon_no, coupon_name, coupon_dc_type, coupon_dc_amount, coupon_dc_rate
		from coupons
	</select>
	
	<!-- 쿠폰 리스트 가져오기(with pagingInfo) -->
	<select id="selectAllCouponWithPi" resultType="CouponDTO">
		select
		coupon_no, coupon_name, coupon_dc_type, coupon_dc_amount, coupon_dc_rate
		from coupons
		order by coupon_no desc
		limit #{startRowIndex}, #{viewDataCntPerPage}
	</select>


	<!-- 쿠폰 생성 -->
	<insert id="insertCoupon">
		insert into coupons(coupon_name, coupon_dc_type,
		coupon_dc_amount, coupon_dc_rate)
		values(#{coupon_name},
		#{coupon_dc_type}, #{coupon_dc_amount}, #{coupon_dc_rate})
	</insert>

	<!-- 쿠폰 수정 -->
	<update id="updateCoupon">
		update coupons 
		set coupon_name = #{coupon_name}, coupon_dc_type = #{coupon_dc_type}, coupon_dc_amount = #{coupon_dc_amount}, coupon_dc_rate = #{coupon_dc_rate}
		where coupon_no = #{coupon_no}
	</update>
	
	<!-- 쿠폰 삭제 -->
	<delete id="deleteCoupon">
		delete from coupons where coupon_no = #{coupon_no};
	</delete>
	
	<!-- 쿠폰 지급 -->
	<insert id="insertCouponPayLogs">
		insert into coupon_paid (coupon_no, coupon_code, member, expire_date)
		values 
		<foreach collection="list" index="index" item="couponPayDTO" separator=", ">
		(
			#{couponPayDTO.coupon_no},
			#{couponPayDTO.coupon_code},
			#{couponPayDTO.member},
			#{couponPayDTO.expire_date}		
		)		
		</foreach>
	</insert>

</mapper>